import { minify } from 'html-minifier-next';
import { createRequire } from 'module';

const require = createRequire(import.meta.url);

const options = {
    cacheCSS: 2000,
    cacheJS: 1000,
    caseSensitive: false,
    collapseAttributeWhitespace: true,
    collapseBooleanAttributes: true,
    collapseInlineTagWhitespace: true,
    collapseWhitespace: true,
    conservativeCollapse: false,
    continueOnMinifyError: true,
    continueOnParseError: true,
    decodeEntities: true,
    ignoreCustomFragments: [
        '<#[\\s\\S]*?#>',
        '<%[\\s\\S]*?%>',
        '<\\?[\\s\\S]*?\\?>'
    ],
    includeAutoGeneratedTags: false,
    inlineCustomElements: [],
    keepClosingSlash: false,
    maxLineLength: 0,
    minifyCSS: true,
    minifyJS: {
        engine: 'swc'
    },
    minifySVG: true,
    minifyURLs: true,
    noNewlinesBeforeTagClose: true,
    partialMarkup: false,
    preserveLineBreaks: false,
    preventAttributesEscaping: true,
    processConditionalComments: true,
    processScripts: [
        'text/html',
        'application/ld+json'
    ],
    removeAttributeQuotes: true,
    removeComments: true,
    removeEmptyAttributes: true,
    removeEmptyElements: true,
    removeEmptyElementsExcept: [],
    removeOptionalTags: true,
    removeRedundantAttributes: true,
    removeScriptTypeAttributes: true,
    removeStyleLinkTypeAttributes: true,
    removeTagWhitespace: false,
    sortAttributes: false,
    sortClassName: false,
    trimCustomFragments: true,
    useShortDoctype: true
};

export default async function (html) {
    return await minify(html, options);
}

export const { version } = require('../node_modules/html-minifier-next/package.json');
